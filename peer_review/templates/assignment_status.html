{% extends 'base_instructor.html' %}
{% load static %}

{% block header %}
    <link rel="stylesheet" href="{% static 'css/common.css' %}" />
    <link rel="stylesheet" href="{% static 'css/assignment_status.css' %}" />
    <script src="{% static 'js/lib/momentjs/moment.min.js' %}"></script>
    <script src="{% static 'js/lib/jquery.tablesorter.min.js' %}" ></script>
    <script src="{% static 'js/assignment_status.js' %}" ></script>
    <script src="{% static 'js/common.js' %}" ></script>
{% endblock %}

{% block content %}
    <div class="dashboard_links">
        <a href="/course/{{ course_id }}/dashboard/instructor" class="link_for_nav is_peer_review">Peer Review</a>
        <p class="slash_between">/</p>
        <p class="text_on_nav">{{ rubric.passback_assignment.title }}</p>
    </div>

    <p class="title">{{ rubric.passback_assignment.title }}</p>

    <div class="dropdown">
        <button class="dropbtn">
            <p class="dropdown-title">Filter reviews by section</p>
            <i class="material-icons dropdown-icon">arrow_drop_down</i>
        </button>
        <div class="dropdown-content">
            <a class="dropdown-link" data-section-id="all" href="#">All Sections</a>
            {% for section in sections %}
                <a class="dropdown-link" data-section-id="{{ section.id }}" href="#">{{ section.name }}</a>
            {% endfor %}
        </div>
    </div>

    <table id="assignment-status-table" class="sortable" data-peer-review-due-date="{{ rubric.passback_assignment.due_date_utc|date:"c" }}">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Section</th>
                <th>Reviews Completed</th>
                <th>Reviews Received</th>
            </tr>
        </thead>
        <tbody>
            {% for review in reviews %}
                <tr class="student_entry"
                    data-student-id="{{ review.author.id }}"
                    data-rubric-id="{{ rubric.id }}"
                    data-sections="{{ review.json_sections }}">
                    <td class="student_name">{{ review.author.sortable_name }}</td>
                    <td class="student_section">
                        {% if review.sections.count > 1 %}
                            {% for section in review.sections %}
                                {{ section.name }}{% if forloop.counter < review.sections.count %},{% endif %}
                            {% endfor %}
                        {% else %}
                            {{ review.sections.0.name }}
                        {% endif %}
                    </td>
                    <td class="student_completed">{{ review.completed }} of {{ review.total_completed }}</td>
                    <td class="student_received">{{ review.received }} of {{ review.total_received }}</td>
                </tr>
            {% endfor %}
        </tbody>        
    </table>

    <style type="text/css">
        .sortable thead tr th.headerSortUp {
            background: url("{% static 'images/icons/arrow_down.svg' %}") no-repeat right white;
        }

        .sortable thead tr th.headerSortDown {
            background: url("{% static 'images/icons/arrow_up.svg' %}") no-repeat right white;
        }
    </style>
{% endblock %}
